{"version":3,"sources":["../src/delta_ctrl.js"],"names":["getColorForValue","data","value","i","thresholds","length","colorMap","_","first","PanelCtrl","moment","$","kbn","TimeSeries","DeltaPluginCtrl","$scope","$injector","$rootScope","panelDefaults","links","datasource","maxDataPoints","interval","targets","cacheTimeout","format","prefix","postfix","nullText","valueMaps","op","text","mappingTypes","name","rangeMaps","from","to","mappingType","nullPointMode","valueName","prefixFontSize","valueFontSize","postfixFontSize","colorBackground","colorValue","colors","sparkline","show","full","lineColor","fillColor","gauge","minValue","maxValue","thresholdMarkers","thresholdLabels","tableColumn","dayInterval","hourInterval","minuteInterval","defaults","panel","events","on","onDataReceived","bind","onDataError","onInitEditMode","OnRefresh","$q","get","datasourceSrv","timeSrv","templateSrv","scope","fontSizes","addEditorTab","unitFormats","getUnitFormats","subItem","render","otherPanelInFullscreenMode","snapshotData","updateTimeRange","isArray","emit","dataStream","error","loading","setTimeQueryStart","then","issueQueries","handleQueryResult","catch","err","cancelled","console","log","message","inspector","timing","queryStart","Date","getTime","queryEnd","intervalOverride","replace","scopedVars","res","calculateInterval","range","resolution","intervalMs","timeInfo","timeFrom","timeFromInterpolated","timeFromInfo","rangeUtil","describeTextRange","invalid","isString","rangeRaw","timeFromDate","dateMath","parse","display","timeShift","timeShiftInterpolated","timeShiftInfo","parseDateMath","hideTimeOverride","timeRange","raw","applyPanelTimeOverrides","Math","ceil","window","width","span","Promise","resolve","reject","when","Object","assign","metricsQuery","panelId","id","renderer","dayI","date","hourI","hour","minuteI","minute","thisMonth","beginThisMonth","startOf","lastMonth","subtract","beginLastMonth","metricCop","query","res1","title","res2","results","setTimeQueryEnd","Error","result","datapoints","subscribe","handleDataStream","dashboard","snapshot","dataList","type","dataType","tableData","map","tableHandler","setTableValues","series","seriesHandler","setValues","seriesData","alias","target","flotpairs","getFlotPairs","columnNames","columns","forEach","column","columnIndex","tableColumnOptions","find","setTableColumnToSensibleDefault","rows","row","datapoint","key","push","col","highestValue","lowestValue","Number","MAX_VALUE","valueFormatted","escape","valueRounded","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","decimals","scaledDecimals","roundValue","setValueMapping","options","background","tmp","isNumber","delta","dec","floor","LN10","magn","pow","norm","size","max","JSON","stringify","lastPoint","last","lastValue","stats","extend","label","parseFloat","index","indexOf","splice","rangeMap","elem","attrs","ctrl","$location","linkSrv","$timeout","linkInfo","$panelContainer","setElementHeight","css","height","applyColoringThresholds","valueString","color","getSpan","className","fontSize","getBigValueHtml","body","getValueText","addGauge","dimension","min","invalidGaugeRange","plotCanvas","plotCss","top","margin","position","bgColor","config","bootData","user","lightTheme","fontScale","parseInt","gaugeWidth","thresholdMarkersWidth","gauges","border","shadow","frame","layout","thresholdWidth","cell","threshold","values","font","formatter","family","append","plotSeries","plot","addSparkline","setTimeout","bottom","left","dynamicHeightMargin","round","legend","lines","fill","lineWidth","yaxes","xaxis","mode","valueOf","grid","hoverable","split","strVale","trim","isNaN","fullscreen","html","toggleClass","getPanelLinkAnchorInfo","hookupDrilldownLinkTooltip","drilldownTooltip","mouseleave","detach","click","evt","parents","redirectWindow","open","href","location","url","mousemove","e","place_tt","pageX","pageY","renderingCompleted","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA85BA,WAASA,gBAAT,CAA0BC,IAA1B,EAAgCC,KAAhC,EAAuC;AACrC,SAAK,IAAIC,IAAIF,KAAKG,UAAL,CAAgBC,MAA7B,EAAqCF,IAAI,CAAzC,EAA4CA,GAA5C,EAAiD;AAC/C,UAAID,SAASD,KAAKG,UAAL,CAAgBD,IAAE,CAAlB,CAAb,EAAmC;AACjC,eAAOF,KAAKK,QAAL,CAAcH,CAAd,CAAP;AACD;AACF;AACD,WAAOI,EAAEC,KAAF,CAAQP,KAAKK,QAAb,CAAP;AACD;;;;AAr6BOG,e,kBAAAA,S;;AAEDC,Y;;AACAH,O;;AACAI,O;;AAGAC,S;;AACAC,gB;;;;;;;;;;;;;;;;;;;;;iCAEMC,e;;;AAEX,iCAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,UAA/B,EAA2C;AAAA;;AAAA,wIACnCF,MADmC,EAC3BC,SAD2B;;AAEzC,gBAAKC,UAAL,GAAkBA,UAAlB;;AAEA,cAAIC,gBAAgB;AAClBC,mBAAO,EADW;AAElBC,wBAAY,IAFM;AAGlBC,2BAAe,GAHG;AAIlBC,sBAAU,IAJQ;AAKlBC,qBAAS,CAAC,EAAD,CALS;AAMlBC,0BAAc,IANI;AAOlBC,oBAAQ,MAPU;AAQlBC,oBAAQ,EARU;AASlBC,qBAAS,EATS;AAUlBC,sBAAU,IAVQ;AAWlBC,uBAAW,CACT,EAAE3B,OAAO,MAAT,EAAiB4B,IAAI,GAArB,EAA0BC,MAAM,KAAhC,EADS,CAXO;AAclBC,0BAAc,CACZ,EAACC,MAAM,eAAP,EAAwB/B,OAAO,CAA/B,EADY,EAEZ,EAAC+B,MAAM,eAAP,EAAwB/B,OAAO,CAA/B,EAFY,CAdI;AAkBlBgC,uBAAW,CACT,EAAEC,MAAM,MAAR,EAAgBC,IAAI,MAApB,EAA4BL,MAAM,KAAlC,EADS,CAlBO;AAqBlBM,yBAAa,CArBK;AAsBlBC,2BAAe,WAtBG;AAuBlBC,uBAAW,KAvBO;AAwBlBC,4BAAgB,KAxBE;AAyBlBC,2BAAe,KAzBG;AA0BlBC,6BAAiB,KA1BC;AA2BlBtC,wBAAY,EA3BM;AA4BlBuC,6BAAiB,KA5BC;AA6BlBC,wBAAY,KA7BM;AA8BlBC,oBAAQ,CAAC,wBAAD,EAA2B,0BAA3B,EAAuD,yBAAvD,CA9BU;AA+BlBC,uBAAW;AACTC,oBAAM,KADG;AAETC,oBAAM,KAFG;AAGTC,yBAAW,mBAHF;AAITC,yBAAW;AAJF,aA/BO;AAqClBC,mBAAO;AACLJ,oBAAM,KADD;AAELK,wBAAU,CAFL;AAGLC,wBAAU,GAHL;AAILC,gCAAkB,IAJb;AAKLC,+BAAiB;AALZ,aArCW;AA4ClBC,yBAAa,EA5CK;AA6ClBC,yBAAa,KA7CK;AA8ClBC,0BAAc,KA9CI;AA+ClBC,4BAAgB;AA/CE,WAApB;;AAkDApD,YAAEqD,QAAF,CAAW,MAAKC,KAAhB,EAAuB3C,aAAvB;;AAEA;AACA,gBAAK4C,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKC,cAAL,CAAoBC,IAApB,OAAhC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKG,WAAL,CAAiBD,IAAjB,OAA7B;AACA;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKI,cAAL,CAAoBF,IAApB,OAAjC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,SAAf,EAA0B,MAAKK,SAAL,CAAeH,IAAf,OAA1B;;AAEA,gBAAKI,EAAL,GAAUrD,UAAUsD,GAAV,CAAc,IAAd,CAAV;AACA,gBAAKC,aAAL,GAAqBvD,UAAUsD,GAAV,CAAc,eAAd,CAArB;AACA,gBAAKE,OAAL,GAAexD,UAAUsD,GAAV,CAAc,SAAd,CAAf;AACA,gBAAKG,WAAL,GAAmBzD,UAAUsD,GAAV,CAAc,aAAd,CAAnB;AACA,gBAAKI,KAAL,GAAa3D,MAAb;;AAnEyC;AAqE1C;;;;2CAEgB;AACf,iBAAK4D,SAAL,GAAiB,CAAC,KAAD,EAAQ,KAAR,EAAc,KAAd,EAAoB,KAApB,EAA0B,KAA1B,EAAgC,MAAhC,EAAwC,MAAxC,EAAgD,MAAhD,EAAwD,MAAxD,EAAgE,MAAhE,EAAwE,MAAxE,CAAjB;AACA,iBAAKC,YAAL,CAAkB,SAAlB,EAA6B,gDAA7B,EAA+E,CAA/E;AACA,iBAAKA,YAAL,CAAkB,SAAlB,EAA6B,iDAA7B,EAAgF,CAAhF;AACA,iBAAKA,YAAL,CAAkB,gBAAlB,EAAoC,mDAApC,EAAyF,CAAzF;AACA,iBAAKA,YAAL,CAAkB,OAAlB,EAA2B,sDAA3B,EAAmF,CAAnF;AACA,iBAAKC,WAAL,GAAmBjE,IAAIkE,cAAJ,EAAnB;AACD;;;wCAEaC,O,EAAS;AACrB,iBAAKlB,KAAL,CAAWpC,MAAX,GAAoBsD,QAAQ7E,KAA5B;AACA,iBAAK8E,MAAL;AACD;;;sCAGW;AAAA;;AACV;AACA,gBAAI,KAAKC,0BAAL,EAAJ,EAAuC;AAAE;AAAS;;AAElD;AACA,gBAAI,KAAKpB,KAAL,CAAWqB,YAAf,EAA6B;AAC3B,mBAAKC,eAAL;AACA,kBAAIlF,OAAO,KAAK4D,KAAL,CAAWqB,YAAtB;AACA;AACA,kBAAI,CAAC3E,EAAE6E,OAAF,CAAUnF,IAAV,CAAL,EAAsB;AACpBA,uBAAOA,KAAKA,IAAZ;AACD;;AAED,mBAAK6D,MAAL,CAAYuB,IAAZ,CAAiB,oBAAjB,EAAuCpF,IAAvC;AACA;AACD;;AAED;AACA,gBAAI,KAAKqF,UAAT,EAAqB;AACnB;AACD;;AAED;AACA,mBAAO,KAAKC,KAAZ;AACA,iBAAKC,OAAL,GAAe,IAAf;;AAEA;AACA,iBAAKC,iBAAL;AACA,iBAAKlB,aAAL,CAAmBD,GAAnB,CAAuB,KAAKT,KAAL,CAAWzC,UAAlC,EACCsE,IADD,CACM,KAAKP,eAAL,CAAqBlB,IAArB,CAA0B,IAA1B,CADN,EAECyB,IAFD,CAEM,KAAKC,YAAL,CAAkB1B,IAAlB,CAAuB,IAAvB,CAFN,EAGCyB,IAHD,CAGM,KAAKE,iBAAL,CAAuB3B,IAAvB,CAA4B,IAA5B,CAHN,EAIC4B,KAJD,CAIO,eAAO;AACZ;AACA,kBAAIC,IAAIC,SAAR,EAAmB;AACjBC,wBAAQC,GAAR,CAAY,yBAAZ,EAAuCH,GAAvC;AACA;AACD;;AAED,qBAAKN,OAAL,GAAe,KAAf;AACA,qBAAKD,KAAL,GAAaO,IAAII,OAAJ,IAAe,eAA5B;AACA,qBAAKC,SAAL,GAAiB,EAACZ,OAAOO,GAAR,EAAjB;;AAEA,kBAAIA,IAAI7F,IAAR,EAAc;AACZ,oBAAI6F,IAAI7F,IAAJ,CAASiG,OAAb,EAAsB;AACpB,yBAAKX,KAAL,GAAaO,IAAI7F,IAAJ,CAASiG,OAAtB;AACD;AACD,oBAAIJ,IAAI7F,IAAJ,CAASsF,KAAb,EAAoB;AAClB,yBAAKA,KAAL,GAAaO,IAAI7F,IAAJ,CAASsF,KAAtB;AACD;AACF;;AAED,qBAAKzB,MAAL,CAAYuB,IAAZ,CAAiB,YAAjB,EAA+BS,GAA/B;AACAE,sBAAQC,GAAR,CAAY,mBAAZ,EAAiCH,GAAjC;AACD,aA1BD;AA2BD;;;8CAEmB;AAClB,iBAAKM,MAAL,CAAYC,UAAZ,GAAyB,IAAIC,IAAJ,GAAWC,OAAX,EAAzB;AACD;;;4CAEiB;AAChB,iBAAKH,MAAL,CAAYI,QAAZ,GAAuB,IAAIF,IAAJ,GAAWC,OAAX,EAAvB;AACD;;;8CAEmB;AAClB,gBAAIE,mBAAmB,KAAK5C,KAAL,CAAWvC,QAAlC;;AAEA;AACA,gBAAImF,gBAAJ,EAAsB;AACpBA,iCAAmB,KAAKhC,WAAL,CAAiBiC,OAAjB,CAAyBD,gBAAzB,EAA2C,KAAK5C,KAAL,CAAW8C,UAAtD,CAAnB;AACD,aAFD,MAEO,IAAI,KAAKvF,UAAL,IAAmB,KAAKA,UAAL,CAAgBE,QAAvC,EAAiD;AACtDmF,iCAAmB,KAAKrF,UAAL,CAAgBE,QAAnC;AACD;;AAED,gBAAIsF,MAAMhG,IAAIiG,iBAAJ,CAAsB,KAAKC,KAA3B,EAAkC,KAAKC,UAAvC,EAAmDN,gBAAnD,CAAV;AACA,iBAAKnF,QAAL,GAAgBsF,IAAItF,QAApB;AACA,iBAAK0F,UAAL,GAAkBJ,IAAII,UAAtB;AACD;;;oDAEyB;AACxB,iBAAKC,QAAL,GAAgB,EAAhB;;AAEA;AACA,gBAAI,KAAKpD,KAAL,CAAWqD,QAAf,EAAyB;AACvB,kBAAIC,uBAAuB,KAAK1C,WAAL,CAAiBiC,OAAjB,CAAyB,KAAK7C,KAAL,CAAWqD,QAApC,EAA8C,KAAKrD,KAAL,CAAW8C,UAAzD,CAA3B;AACA,kBAAIS,eAAeC,UAAUC,iBAAV,CAA4BH,oBAA5B,CAAnB;AACA,kBAAIC,aAAaG,OAAjB,EAA0B;AACxB,qBAAKN,QAAL,GAAgB,uBAAhB;AACA;AACD;;AAED,kBAAI1G,EAAEiH,QAAF,CAAW,KAAKC,QAAL,CAActF,IAAzB,CAAJ,EAAoC;AAClC,oBAAIuF,eAAeC,SAASC,KAAT,CAAeR,aAAajF,IAA5B,CAAnB;AACA,qBAAK8E,QAAL,GAAgBG,aAAaS,OAA7B;AACA,qBAAKJ,QAAL,CAActF,IAAd,GAAqBiF,aAAajF,IAAlC;AACA,qBAAKsF,QAAL,CAAcrF,EAAd,GAAmBgF,aAAahF,EAAhC;AACA,qBAAK0E,KAAL,CAAW3E,IAAX,GAAkBuF,YAAlB;AACA,qBAAKZ,KAAL,CAAW1E,EAAX,GAAgBuF,SAASC,KAAT,CAAeR,aAAahF,EAA5B,CAAhB;AACD;AACF;;AAED,gBAAI,KAAKyB,KAAL,CAAWiE,SAAf,EAA0B;AACxB,kBAAIC,wBAAwB,KAAKtD,WAAL,CAAiBiC,OAAjB,CAAyB,KAAK7C,KAAL,CAAWiE,SAApC,EAA+C,KAAKjE,KAAL,CAAW8C,UAA1D,CAA5B;AACA,kBAAIqB,gBAAgBX,UAAUC,iBAAV,CAA4BS,qBAA5B,CAApB;AACA,kBAAIC,cAAcT,OAAlB,EAA2B;AACzB,qBAAKN,QAAL,GAAgB,mBAAhB;AACA;AACD;;AAED,kBAAIa,YAAY,MAAMC,qBAAtB;AACA,mBAAKd,QAAL,IAAiB,gBAAgBa,SAAjC;AACA,mBAAKhB,KAAL,CAAW3E,IAAX,GAAkBwF,SAASM,aAAT,CAAuBH,SAAvB,EAAkC,KAAKhB,KAAL,CAAW3E,IAA7C,EAAmD,KAAnD,CAAlB;AACA,mBAAK2E,KAAL,CAAW1E,EAAX,GAAgBuF,SAASM,aAAT,CAAuBH,SAAvB,EAAkC,KAAKhB,KAAL,CAAW1E,EAA7C,EAAiD,IAAjD,CAAhB;;AAEA,mBAAKqF,QAAL,GAAgB,KAAKX,KAArB;AACD;;AAED,gBAAI,KAAKjD,KAAL,CAAWqE,gBAAf,EAAiC;AAC/B,mBAAKjB,QAAL,GAAgB,EAAhB;AACD;AACF;;;0CAEe7F,U,EAAY;AAC1B,iBAAKA,UAAL,GAAkBA,cAAc,KAAKA,UAArC;AACA,iBAAK0F,KAAL,GAAa,KAAKtC,OAAL,CAAa2D,SAAb,EAAb;AACA,iBAAKV,QAAL,GAAgB,KAAKX,KAAL,CAAWsB,GAA3B;;AAEA,iBAAKC,uBAAL;;AAEA,gBAAI,KAAKxE,KAAL,CAAWxC,aAAf,EAA8B;AAC5B,mBAAK0F,UAAL,GAAkB,KAAKlD,KAAL,CAAWxC,aAA7B;AACD,aAFD,MAEO;AACL,mBAAK0F,UAAL,GAAkBuB,KAAKC,IAAL,CAAU5H,EAAE6H,MAAF,EAAUC,KAAV,MAAqB,KAAK5E,KAAL,CAAW6E,IAAX,GAAkB,EAAvC,CAAV,CAAlB;AACD;;AAED,iBAAK7B,iBAAL;;AAEA,mBAAO,KAAKzF,UAAZ;AACD;;;uCAEYA,U,EAAY;AAAA;;AACvB,mBAAO,IAAIuH,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,qBAAKzH,UAAL,GAAkBA,UAAlB;;AAEA,kBAAI,CAAC,OAAKyC,KAAL,CAAWtC,OAAZ,IAAuB,OAAKsC,KAAL,CAAWtC,OAAX,CAAmBlB,MAAnB,KAA8B,CAAzD,EAA4D;AAC1D,uBAAO,OAAKgE,EAAL,CAAQyE,IAAR,CAAa,EAAb,CAAP;AACD;;AAED;AACA;AACA,kBAAInC,aAAaoC,OAAOC,MAAP,CAAc,EAAd,EAAkB,OAAKnF,KAAL,CAAW8C,UAA7B,EAAyC;AACxD,8BAAkB,EAAC5E,MAAM,OAAKT,QAAZ,EAAwBpB,OAAO,OAAKoB,QAApC,EADsC;AAExD,iCAAkB,EAACS,MAAM,OAAKiF,UAAZ,EAAwB9G,OAAO,OAAK8G,UAApC;AAFsC,eAAzC,CAAjB;;AAKA,kBAAIiC,eAAe;AACjBC,yBAAS,OAAKrF,KAAL,CAAWsF,EADH;AAEjBrC,uBAAO,OAAKA,KAFK;AAGjBW,0BAAU,OAAKA,QAHE;AAIjBnG,0BAAU,OAAKA,QAJE;AAKjB0F,4BAAY,OAAKA,UALA;AAMjBzF,yBAAS,OAAKsC,KAAL,CAAWtC,OANH;AAOjBE,wBAAQ,OAAKoC,KAAL,CAAWuF,QAAX,KAAwB,KAAxB,GAAgC,KAAhC,GAAwC,MAP/B;AAQjB/H,+BAAe,OAAK0F,UARH;AASjBJ,4BAAYA,UATK;AAUjBnF,8BAAc,OAAKqC,KAAL,CAAWrC;AAVR,eAAnB;;AAaA,kBAAM6H,OAAO,OAAKxF,KAAL,CAAWJ,WAAX,KAA2B,KAA3B,GAAmC/C,SAAS4I,IAAT,EAAnC,GAAqD,OAAKzF,KAAL,CAAWJ,WAA7E;AACA,kBAAM8F,QAAQ,OAAK1F,KAAL,CAAWH,YAAX,KAA4B,KAA5B,GAAoChD,SAAS8I,IAAT,EAApC,GAAsD,OAAK3F,KAAL,CAAWH,YAA/E;AACA,kBAAM+F,UAAU,OAAK5F,KAAL,CAAWF,cAAX,KAA8B,KAA9B,GAAsCjD,SAASgJ,MAAT,EAAtC,GAA0D,OAAK7F,KAAL,CAAWF,cAArF;;AAEA,kBAAMgG,YAAYjJ,OAAOuI,aAAanC,KAAb,CAAmB1E,EAA1B,EAA8BkH,IAA9B,CAAmCD,IAAnC,EAAyCG,IAAzC,CAA8CD,KAA9C,EAAqDG,MAArD,CAA4DD,OAA5D,CAAlB;AACA,kBAAMG,iBAAiBlJ,OAAOiJ,SAAP,EAAkBE,OAAlB,CAA0B,OAA1B,CAAvB;AACA,kBAAMC,YAAYpJ,OAAOiJ,SAAP,EAAkBI,QAAlB,CAA2B,CAA3B,EAA8B,OAA9B,CAAlB;AACA,kBAAMC,iBAAiBtJ,OAAOoJ,SAAP,EAAkBD,OAAlB,CAA0B,OAA1B,CAAvB;;AAEA,kBAAMI,YAAYlB,OAAOC,MAAP,CAAc,EAAd,EAAkBC,YAAlB,CAAlB;AACAA,2BAAaxB,QAAb,CAAsBtF,IAAtB,GAA6ByH,cAA7B;AACAX,2BAAaxB,QAAb,CAAsBrF,EAAtB,GAA2BuH,SAA3B;AACA,qBAAOvI,WAAW8I,KAAX,CAAiBjB,YAAjB,EACNvD,IADM,CACD,UAACyE,IAAD,EAAU;AACdF,0BAAUxC,QAAV,CAAmBtF,IAAnB,GAA0B6H,cAA1B;AACAC,0BAAUxC,QAAV,CAAmBrF,EAAnB,GAAwB0H,SAAxB;AACA,uBAAKjG,KAAL,CAAWuG,KAAX,cAA4BJ,eAAevI,MAAf,CAAsB,kBAAtB,CAA5B,WAA2EqI,UAAUrI,MAAV,CAAiB,kBAAjB,CAA3E,WAAqHmI,eAAenI,MAAf,CAAsB,kBAAtB,CAArH,WAAoKkI,UAAUlI,MAAV,CAAiB,kBAAjB,CAApK;AACA,uBAAOL,WAAW8I,KAAX,CAAiBD,SAAjB,EACNvE,IADM,CACD,UAAC2E,IAAD;AAAA,yBAAUzB,QAAQ,CAACuB,IAAD,EAAOE,IAAP,CAAR,CAAV;AAAA,iBADC,EAENxE,KAFM,CAEA,UAACC,GAAD;AAAA,yBAAS+C,OAAO/C,GAAP,CAAT;AAAA,iBAFA,CAAP;AAGD,eARM,EASND,KATM,CASA,UAACC,GAAD;AAAA,uBAAS+C,OAAO/C,GAAP,CAAT;AAAA,eATA,CAAP;AAUD,aAjDM,CAAP;AAkDD;;;4CAEiBwE,O,EAAS;AACzB,iBAAKC,eAAL;AACA,iBAAK/E,OAAL,GAAe,KAAf;;AAEAQ,oBAAQC,GAAR,CAAYqE,OAAZ;AACA,gBAAIA,QAAQ,CAAR,EAAWrK,IAAX,CAAgBI,MAAhB,IAA0B,CAA1B,IAA+BiK,QAAQ,CAAR,EAAWrK,IAAX,CAAgBI,MAAhB,IAA0B,CAA7D,EAAgE;AAC9D,kBAAIkF,QAAQ,IAAIiF,KAAJ,EAAZ;AACAjF,oBAAMW,OAAN,GAAgB,0BAAhB;AACAX,oBAAMtF,IAAN,GAAa,iBAAb;AACA,oBAAMsF,KAAN;AACD;;AAED,gBAAI,OAAO+E,QAAQ,CAAR,EAAWrK,IAAX,CAAgB,CAAhB,CAAP,KAA8B,WAAlC,EAA8C;AAC5CwK,uBAAS,EAACxK,MAAM,EAAP,EAAT;AACA+F,sBAAQC,GAAR,CAAY,YAAZ;AACA;AACD;;AAEDqE,oBAAQ,CAAR,EAAWrK,IAAX,CAAgB,CAAhB,EAAmByK,UAAnB,CAA8B,CAA9B,EAAiC,CAAjC,KAAuCJ,QAAQ,CAAR,EAAWrK,IAAX,CAAgB,CAAhB,EAAmByK,UAAnB,CAA8B,CAA9B,EAAiC,CAAjC,CAAvC;AACA,gBAAID,SAASH,QAAQ,CAAR,CAAb;;AAEA;AACA,gBAAIG,UAAUA,OAAOE,SAArB,EAAgC;AAC9B,mBAAKC,gBAAL,CAAsBH,MAAtB;AACA;AACD;;AAED,gBAAI,KAAKI,SAAL,CAAeC,QAAnB,EAA6B;AAC3B,mBAAKjH,KAAL,CAAWqB,YAAX,GAA0BuF,OAAOxK,IAAjC;AACD;;AAED,gBAAI,CAACwK,MAAD,IAAW,CAACA,OAAOxK,IAAvB,EAA6B;AAC3B+F,sBAAQC,GAAR,CAAY,uDAAZ,EAAqEwE,MAArE;AACAA,uBAAS,EAACxK,MAAM,EAAP,EAAT;AACD;;AAED,mBAAO,KAAK6D,MAAL,CAAYuB,IAAZ,CAAiB,eAAjB,EAAkCoF,OAAOxK,IAAzC,CAAP;AACD;;;sCAEW6F,G,EAAK;AACf,iBAAK9B,cAAL,CAAoB,EAApB;AACD;;;yCAEc+G,Q,EAAU;AACvB,gBAAM9K,OAAO,EAAb;AACA,gBAAI8K,SAAS1K,MAAT,GAAkB,CAAlB,IAAuB0K,SAAS,CAAT,EAAYC,IAAZ,KAAqB,OAAhD,EAAwD;AACtD,mBAAKC,QAAL,GAAgB,OAAhB;AACA,kBAAMC,YAAYH,SAASI,GAAT,CAAa,KAAKC,YAAL,CAAkBnH,IAAlB,CAAuB,IAAvB,CAAb,CAAlB;AACA,mBAAKoH,cAAL,CAAoBH,SAApB,EAA+BjL,IAA/B;AACD,aAJD,MAIO;AACL,mBAAKgL,QAAL,GAAgB,YAAhB;AACA,mBAAKK,MAAL,GAAcP,SAASI,GAAT,CAAa,KAAKI,aAAL,CAAmBtH,IAAnB,CAAwB,IAAxB,CAAb,CAAd;AACA,mBAAKuH,SAAL,CAAevL,IAAf;AACD;AACD,iBAAKA,IAAL,GAAYA,IAAZ;AACA,iBAAK+E,MAAL;AACD;;;wCAEayG,U,EAAY;AACxB,gBAAIH,SAAS,IAAIzK,UAAJ,CAAe;AAC1B6J,0BAAYe,WAAWf,UADG;AAE1BgB,qBAAOD,WAAWE;AAFQ,aAAf,CAAb;;AAKAL,mBAAOM,SAAP,GAAmBN,OAAOO,YAAP,CAAoB,KAAKhI,KAAL,CAAWvB,aAA/B,CAAnB;AACA,mBAAOgJ,MAAP;AACD;;;uCAEYJ,S,EAAW;AACtB,gBAAMR,aAAa,EAAnB;AACA,gBAAMoB,cAAc,EAApB;;AAEAZ,sBAAUa,OAAV,CAAkBC,OAAlB,CAA0B,UAACC,MAAD,EAASC,WAAT,EAAyB;AACjDJ,0BAAYI,WAAZ,IAA2BD,OAAOlK,IAAlC;AACD,aAFD;;AAIA,iBAAKoK,kBAAL,GAA0BL,WAA1B;AACA,gBAAI,CAACvL,EAAE6L,IAAF,CAAOlB,UAAUa,OAAjB,EAA0B,CAAC,MAAD,EAAS,KAAKlI,KAAL,CAAWL,WAApB,CAA1B,CAAL,EAAkE;AAChE,mBAAK6I,+BAAL,CAAqCnB,SAArC;AACD;;AAEDA,sBAAUoB,IAAV,CAAeN,OAAf,CAAuB,UAACO,GAAD,EAAS;AAC9B,kBAAMC,YAAY,EAAlB;;AAEAD,kBAAIP,OAAJ,CAAY,UAAC9L,KAAD,EAAQgM,WAAR,EAAwB;AAClC,oBAAMO,MAAMX,YAAYI,WAAZ,CAAZ;AACAM,0BAAUC,GAAV,IAAiBvM,KAAjB;AACD,eAHD;;AAKAwK,yBAAWgC,IAAX,CAAgBF,SAAhB;AACD,aATD;;AAWA,mBAAO9B,UAAP;AACD;;;0DAE+BQ,S,EAAW;AACzC,gBAAI,KAAKiB,kBAAL,CAAwB9L,MAAxB,KAAmC,CAAvC,EAA0C;AACxC,mBAAKwD,KAAL,CAAWL,WAAX,GAAyB,KAAK2I,kBAAL,CAAwB,CAAxB,CAAzB;AACD,aAFD,MAEO;AACL,mBAAKtI,KAAL,CAAWL,WAAX,GAAyBjD,EAAE6L,IAAF,CAAOlB,UAAUa,OAAjB,EAA0B,UAACY,GAAD,EAAS;AAAE,uBAAOA,IAAI3B,IAAJ,KAAa,MAApB;AAA6B,eAAlE,EAAoEjJ,IAA7F;AACD;AACF;;;yCAEcmJ,S,EAAWjL,I,EAAM;AAC9B,gBAAI,CAACiL,SAAD,IAAcA,UAAU7K,MAAV,KAAqB,CAAvC,EAA0C;AACxC;AACD;;AAED,gBAAI6K,UAAU,CAAV,EAAa7K,MAAb,KAAwB,CAAxB,IAA6B,CAAC6K,UAAU,CAAV,EAAa,CAAb,EAAgB,KAAKrH,KAAL,CAAWL,WAA3B,CAAlC,EAA2E;AACzE;AACD;;AAED,gBAAIoJ,eAAe,CAAnB;AACA,gBAAIC,cAAcC,OAAOC,SAAzB;AACA,gBAAMP,YAAYtB,UAAU,CAAV,EAAa,CAAb,CAAlB;AACAjL,iBAAKC,KAAL,GAAasM,UAAU,KAAK3I,KAAL,CAAWL,WAArB,CAAb;;AAEA,gBAAIjD,EAAEiH,QAAF,CAAWvH,KAAKC,KAAhB,CAAJ,EAA4B;AAC1BD,mBAAK+M,cAAL,GAAsBzM,EAAE0M,MAAF,CAAShN,KAAKC,KAAd,CAAtB;AACAD,mBAAKC,KAAL,GAAa,CAAb;AACAD,mBAAKiN,YAAL,GAAoB,CAApB;AACD,aAJD,MAIO;AACL,kBAAMC,cAAc,KAAKC,mBAAL,CAAyBnN,KAAKC,KAA9B,CAApB;AACA,kBAAMmN,aAAazM,IAAI0M,YAAJ,CAAiB,KAAKzJ,KAAL,CAAWpC,MAA5B,CAAnB;AACAxB,mBAAK+M,cAAL,GAAsBK,WAAWb,UAAU,KAAK3I,KAAL,CAAWL,WAArB,CAAX,EAA8C2J,YAAYI,QAA1D,EAAoEJ,YAAYK,cAAhF,CAAtB;AACAvN,mBAAKiN,YAAL,GAAoBtM,IAAI6M,UAAJ,CAAexN,KAAKC,KAApB,EAA2B,KAAK2D,KAAL,CAAW0J,QAAX,IAAuB,CAAlD,CAApB;AACD;;AAED,iBAAKG,eAAL,CAAqBzN,IAArB;AACD;;;sCAEW0N,O,EAAS;AACnB,gBAAIA,QAAQC,UAAZ,EAAwB;AACtB,mBAAK/J,KAAL,CAAWjB,UAAX,GAAwB,KAAxB;AACA,mBAAKiB,KAAL,CAAWhB,MAAX,GAAoB,CAAC,wBAAD,EAA2B,0BAA3B,EAAuD,yBAAvD,CAApB;AACD,aAHD,MAGO;AACL,mBAAKgB,KAAL,CAAWlB,eAAX,GAA6B,KAA7B;AACA,mBAAKkB,KAAL,CAAWhB,MAAX,GAAoB,CAAC,yBAAD,EAA4B,0BAA5B,EAAwD,wBAAxD,CAApB;AACD;AACD,iBAAKmC,MAAL;AACD;;;6CAEkB;AACjB,gBAAI6I,MAAM,KAAKhK,KAAL,CAAWhB,MAAX,CAAkB,CAAlB,CAAV;AACA,iBAAKgB,KAAL,CAAWhB,MAAX,CAAkB,CAAlB,IAAuB,KAAKgB,KAAL,CAAWhB,MAAX,CAAkB,CAAlB,CAAvB;AACA,iBAAKgB,KAAL,CAAWhB,MAAX,CAAkB,CAAlB,IAAuBgL,GAAvB;AACA,iBAAK7I,MAAL;AACD;;;8CAEmB9E,K,EAAO;AACzB,gBAAIK,EAAEuN,QAAF,CAAW,KAAKjK,KAAL,CAAW0J,QAAtB,CAAJ,EAAqC;AACnC,qBAAO,EAACA,UAAU,KAAK1J,KAAL,CAAW0J,QAAtB,EAAgCC,gBAAgB,IAAhD,EAAP;AACD;;AAED,gBAAIO,QAAQ7N,QAAQ,CAApB;AACA,gBAAI8N,MAAM,CAAC1F,KAAK2F,KAAL,CAAW3F,KAAKrC,GAAL,CAAS8H,KAAT,IAAkBzF,KAAK4F,IAAlC,CAAX;;AAEA,gBAAIC,OAAO7F,KAAK8F,GAAL,CAAS,EAAT,EAAa,CAACJ,GAAd,CAAX;AAAA,gBACAK,OAAON,QAAQI,IADf;AAAA,gBACqB;AACrBG,gBAFA;;AAIA,gBAAID,OAAO,GAAX,EAAgB;AACdC,qBAAO,CAAP;AACD,aAFD,MAEO,IAAID,OAAO,CAAX,EAAc;AACnBC,qBAAO,CAAP;AACA;AACA,kBAAID,OAAO,IAAX,EAAiB;AACfC,uBAAO,GAAP;AACA,kBAAEN,GAAF;AACD;AACF,aAPM,MAOA,IAAIK,OAAO,GAAX,EAAgB;AACrBC,qBAAO,CAAP;AACD,aAFM,MAEA;AACLA,qBAAO,EAAP;AACD;;AAEDA,oBAAQH,IAAR;;AAEA;AACA,gBAAI7F,KAAK2F,KAAL,CAAW/N,KAAX,MAAsBA,KAA1B,EAAiC;AAAE8N,oBAAM,CAAN;AAAU;;AAE7C,gBAAIvD,SAAS,EAAb;AACAA,mBAAO8C,QAAP,GAAkBjF,KAAKiG,GAAL,CAAS,CAAT,EAAYP,GAAZ,CAAlB;AACAvD,mBAAO+C,cAAP,GAAwB/C,OAAO8C,QAAP,GAAkBjF,KAAK2F,KAAL,CAAW3F,KAAKrC,GAAL,CAASqI,IAAT,IAAiBhG,KAAK4F,IAAjC,CAAlB,GAA2D,CAAnF;;AAEA,mBAAOzD,MAAP;AACD;;;oCAESxK,I,EAAM;AACdA,iBAAK2L,SAAL,GAAiB,EAAjB;;AAEA,gBAAI,KAAKN,MAAL,CAAYjL,MAAZ,GAAqB,CAAzB,EAA4B;AAC1B,kBAAIkF,QAAQ,IAAIiF,KAAJ,EAAZ;AACAjF,oBAAMW,OAAN,GAAgB,uBAAhB;AACAX,oBAAMtF,IAAN,GAAa,0BAA0B,KAAKqL,MAAL,CAAYjL,MAAtC,GACb,oEADa,GACwDmO,KAAKC,SAAL,CAAe,KAAKnD,MAApB,CADrE;AAEA,oBAAM/F,KAAN;AACD;;AAED,gBAAI,KAAK+F,MAAL,IAAe,KAAKA,MAAL,CAAYjL,MAAZ,GAAqB,CAAxC,EAA2C;AACzC,kBAAIqO,YAAYnO,EAAEoO,IAAF,CAAO,KAAKrD,MAAL,CAAY,CAAZ,EAAeZ,UAAtB,CAAhB;AACA,kBAAIkE,YAAYrO,EAAE6E,OAAF,CAAUsJ,SAAV,IAAuBA,UAAU,CAAV,CAAvB,GAAsC,IAAtD;;AAEA,kBAAI,KAAK7K,KAAL,CAAWtB,SAAX,KAAyB,MAA7B,EAAqC;AACnCtC,qBAAKC,KAAL,GAAa,CAAb;AACAD,qBAAKiN,YAAL,GAAoB,CAApB;AACAjN,qBAAK+M,cAAL,GAAsB,KAAK1B,MAAL,CAAY,CAAZ,EAAeI,KAArC;AACD,eAJD,MAIO,IAAInL,EAAEiH,QAAF,CAAWoH,SAAX,CAAJ,EAA2B;AAChC3O,qBAAKC,KAAL,GAAa,CAAb;AACAD,qBAAK+M,cAAL,GAAsBzM,EAAE0M,MAAF,CAAS2B,SAAT,CAAtB;AACA3O,qBAAKiN,YAAL,GAAoB,CAApB;AACD,eAJM,MAIA;AACLjN,qBAAKC,KAAL,GAAa,KAAKoL,MAAL,CAAY,CAAZ,EAAeuD,KAAf,CAAqB,KAAKhL,KAAL,CAAWtB,SAAhC,CAAb;AACAtC,qBAAK2L,SAAL,GAAiB,KAAKN,MAAL,CAAY,CAAZ,EAAeM,SAAhC;;AAEA,oBAAIuB,cAAc,KAAKC,mBAAL,CAAyBnN,KAAKC,KAA9B,CAAlB;AACA,oBAAImN,aAAazM,IAAI0M,YAAJ,CAAiB,KAAKzJ,KAAL,CAAWpC,MAA5B,CAAjB;AACAxB,qBAAK+M,cAAL,GAAsBK,WAAWpN,KAAKC,KAAhB,EAAuBiN,YAAYI,QAAnC,EAA6CJ,YAAYK,cAAzD,CAAtB;AACAvN,qBAAKiN,YAAL,GAAoBtM,IAAI6M,UAAJ,CAAexN,KAAKC,KAApB,EAA2BiN,YAAYI,QAAvC,CAApB;AACD;;AAED;AACAtN,mBAAK0G,UAAL,GAAkBpG,EAAEuO,MAAF,CAAS,EAAT,EAAa,KAAKjL,KAAL,CAAW8C,UAAxB,CAAlB;AACA1G,mBAAK0G,UAAL,CAAgB,QAAhB,IAA4B,EAACzG,OAAO,KAAKoL,MAAL,CAAY,CAAZ,EAAeyD,KAAvB,EAA5B;AACD;AACD,iBAAKrB,eAAL,CAAqBzN,IAArB;AACD;;;0CAEeA,I,EAAM;AACpB;AACA,gBAAI,KAAK4D,KAAL,CAAWxB,WAAX,KAA2B,CAA/B,EAAkC;AAChC,mBAAK,IAAIlC,IAAI,CAAb,EAAgBA,IAAI,KAAK0D,KAAL,CAAWhC,SAAX,CAAqBxB,MAAzC,EAAiDF,GAAjD,EAAsD;AACpD,oBAAIgL,MAAM,KAAKtH,KAAL,CAAWhC,SAAX,CAAqB1B,CAArB,CAAV;AACA;AACA,oBAAIgL,IAAIjL,KAAJ,KAAc,MAAlB,EAA0B;AACxB,sBAAID,KAAKC,KAAL,KAAe,IAAf,IAAuBD,KAAKC,KAAL,KAAe,KAAK,CAA/C,EAAkD;AAChDD,yBAAK+M,cAAL,GAAsB7B,IAAIpJ,IAA1B;AACA;AACD;AACD;AACD;;AAED;AACA,oBAAI7B,QAAQ8O,WAAW7D,IAAIjL,KAAf,CAAZ;AACA,oBAAIA,UAAUD,KAAKiN,YAAnB,EAAiC;AAC/BjN,uBAAK+M,cAAL,GAAsB7B,IAAIpJ,IAA1B;AACA;AACD;AACF;AACF,aAnBD,MAmBO,IAAI,KAAK8B,KAAL,CAAWxB,WAAX,KAA2B,CAA/B,EAAkC;AACvC,mBAAK,IAAIlC,KAAI,CAAb,EAAgBA,KAAI,KAAK0D,KAAL,CAAW3B,SAAX,CAAqB7B,MAAzC,EAAiDF,IAAjD,EAAsD;AACpD,oBAAIgL,OAAM,KAAKtH,KAAL,CAAW3B,SAAX,CAAqB/B,EAArB,CAAV;AACA;AACA,oBAAIgL,KAAIhJ,IAAJ,KAAa,MAAb,IAAuBgJ,KAAI/I,EAAJ,KAAW,MAAtC,EAA8C;AAC5C,sBAAInC,KAAKC,KAAL,KAAe,IAAf,IAAuBD,KAAKC,KAAL,KAAe,KAAK,CAA/C,EAAkD;AAChDD,yBAAK+M,cAAL,GAAsB7B,KAAIpJ,IAA1B;AACA;AACD;AACD;AACD;;AAED;AACA,oBAAII,OAAO6M,WAAW7D,KAAIhJ,IAAf,CAAX;AACA,oBAAIC,KAAK4M,WAAW7D,KAAI/I,EAAf,CAAT;AACA,oBAAIA,MAAMnC,KAAKiN,YAAX,IAA2B/K,QAAQlC,KAAKiN,YAA5C,EAA0D;AACxDjN,uBAAK+M,cAAL,GAAsB7B,KAAIpJ,IAA1B;AACA;AACD;AACF;AACF;;AAED,gBAAI9B,KAAKC,KAAL,KAAe,IAAf,IAAuBD,KAAKC,KAAL,KAAe,KAAK,CAA/C,EAAkD;AAChDD,mBAAK+M,cAAL,GAAsB,UAAtB;AACD;AACF;;;yCAEc7B,G,EAAK;AAClB,gBAAI8D,QAAQ1O,EAAE2O,OAAF,CAAU,KAAKrL,KAAL,CAAWhC,SAArB,EAAgCsJ,GAAhC,CAAZ;AACA,iBAAKtH,KAAL,CAAWhC,SAAX,CAAqBsN,MAArB,CAA4BF,KAA5B,EAAmC,CAAnC;AACA,iBAAKjK,MAAL;AACD;;;wCAEa;AACZ,iBAAKnB,KAAL,CAAWhC,SAAX,CAAqB6K,IAArB,CAA0B,EAACxM,OAAO,EAAR,EAAY4B,IAAI,GAAhB,EAAqBC,MAAM,EAA3B,EAA1B;AACD;;;yCAEcqN,Q,EAAU;AACvB,gBAAIH,QAAQ1O,EAAE2O,OAAF,CAAU,KAAKrL,KAAL,CAAW3B,SAArB,EAAgCkN,QAAhC,CAAZ;AACA,iBAAKvL,KAAL,CAAW3B,SAAX,CAAqBiN,MAArB,CAA4BF,KAA5B,EAAmC,CAAnC;AACA,iBAAKjK,MAAL;AACD;;;wCAEa;AACZ,iBAAKnB,KAAL,CAAW3B,SAAX,CAAqBwK,IAArB,CAA0B,EAACvK,MAAM,EAAP,EAAWC,IAAI,EAAf,EAAmBL,MAAM,EAAzB,EAA1B;AACD;;;+BAEI2C,K,EAAO2K,I,EAAMC,K,EAAOC,I,EAAM;AAC7B,gBAAIC,YAAY,KAAKA,SAArB;AACA,gBAAIC,UAAU,KAAKA,OAAnB;AACA,gBAAIC,WAAW,KAAKA,QAApB;AACA,gBAAI7L,QAAQ0L,KAAK1L,KAAjB;AACA,gBAAIY,cAAc,KAAKA,WAAvB;AACA,gBAAIxE,IAAJ,EAAU0P,QAAV;AACA,gBAAIC,kBAAkBP,KAAKjD,IAAL,CAAU,kBAAV,CAAtB;AACAiD,mBAAOA,KAAKjD,IAAL,CAAU,mBAAV,CAAP;;AAEA,qBAASyD,gBAAT,GAA4B;AAC1BR,mBAAKS,GAAL,CAAS,QAAT,EAAmBP,KAAKQ,MAAL,GAAc,IAAjC;AACD;;AAED,qBAASC,uBAAT,CAAiC9P,KAAjC,EAAwC+P,WAAxC,EAAqD;AACnD,kBAAI,CAACpM,MAAMjB,UAAX,EAAuB;AACrB,uBAAOqN,WAAP;AACD;;AAED,kBAAIC,QAAQlQ,iBAAiBC,IAAjB,EAAuBC,KAAvB,CAAZ;AACA,kBAAIgQ,KAAJ,EAAW;AACT,uBAAO,wBAAwBA,KAAxB,GAAgC,IAAhC,GAAsCD,WAAtC,GAAoD,SAA3D;AACD;;AAED,qBAAOA,WAAP;AACD;;AAED,qBAASE,OAAT,CAAiBC,SAAjB,EAA4BC,QAA5B,EAAsCnQ,KAAtC,EAA8C;AAC5CA,sBAAQuE,YAAYiC,OAAZ,CAAoBxG,KAApB,EAA2BD,KAAK0G,UAAhC,CAAR;AACA,qBAAO,kBAAkByJ,SAAlB,GAA8B,qBAA9B,GAAsDC,QAAtD,GAAiE,IAAjE,GACPnQ,KADO,GACC,SADR;AAED;;AAED,qBAASoQ,eAAT,GAA2B;AACzB,kBAAIC,OAAO,gDAAX;;AAEA,kBAAI1M,MAAMnC,MAAV,EAAkB;AAAE6O,wBAAQJ,QAAQ,yBAAR,EAAmCtM,MAAMrB,cAAzC,EAAyDqB,MAAMnC,MAA/D,CAAR;AAAiF;;AAErG,kBAAIxB,QAAQ8P,wBAAwB/P,KAAKC,KAA7B,EAAoCD,KAAK+M,cAAzC,CAAZ;AACAuD,sBAAQJ,QAAQ,wBAAR,EAAkCtM,MAAMpB,aAAxC,EAAuDvC,KAAvD,CAAR;;AAEA,kBAAI2D,MAAMlC,OAAV,EAAmB;AAAE4O,wBAAQJ,QAAQ,0BAAR,EAAoCtM,MAAMnB,eAA1C,EAA2DmB,MAAMlC,OAAjE,CAAR;AAAoF;;AAEzG4O,sBAAQ,QAAR;;AAEA,qBAAOA,IAAP;AACD;;AAED,qBAASC,YAAT,GAAwB;AACtB,kBAAI/F,SAAS5G,MAAMnC,MAAN,GAAemC,MAAMnC,MAArB,GAA8B,EAA3C;AACA+I,wBAAUxK,KAAK+M,cAAf;AACAvC,wBAAU5G,MAAMlC,OAAN,GAAgBkC,MAAMlC,OAAtB,GAAgC,EAA1C;;AAEA,qBAAO8I,MAAP;AACD;;AAED,qBAASgG,QAAT,GAAoB;AAClB,kBAAIhI,QAAQ4G,KAAK5G,KAAL,EAAZ;AACA,kBAAIsH,SAASV,KAAKU,MAAL,EAAb;AACA,kBAAIW,YAAYpI,KAAKqI,GAAL,CAASlI,KAAT,EAAgBsH,MAAhB,CAAhB;;AAEAR,mBAAKqB,iBAAL,GAAyB,KAAzB;AACA,kBAAI/M,MAAMV,KAAN,CAAYC,QAAZ,GAAuBS,MAAMV,KAAN,CAAYE,QAAvC,EAAiD;AAC/CkM,qBAAKqB,iBAAL,GAAyB,IAAzB;AACA;AACD;;AAED,kBAAIC,aAAalQ,EAAE,aAAF,CAAjB;AACA,kBAAImQ,UAAU;AACZC,qBAAK,MADO;AAEZC,wBAAQ,MAFI;AAGZC,0BAAU,UAHE;AAIZlB,wBAASA,SAAS,GAAV,GAAiB,IAJb;AAKZtH,uBAAQiI,YAAY;AALR,eAAd;;AAQAG,yBAAWf,GAAX,CAAegB,OAAf;;AAEA,kBAAI1Q,aAAa,EAAjB;AACA,mBAAK,IAAID,IAAI,CAAb,EAAgBA,IAAIF,KAAKG,UAAL,CAAgBC,MAApC,EAA4CF,GAA5C,EAAiD;AAC/CC,2BAAWsM,IAAX,CAAgB;AACdxM,yBAAOD,KAAKG,UAAL,CAAgBD,CAAhB,CADO;AAEd+P,yBAAOjQ,KAAKK,QAAL,CAAcH,CAAd;AAFO,iBAAhB;AAID;AACDC,yBAAWsM,IAAX,CAAgB;AACdxM,uBAAO2D,MAAMV,KAAN,CAAYE,QADL;AAEd6M,uBAAOjQ,KAAKK,QAAL,CAAcL,KAAKK,QAAL,CAAcD,MAAd,GAAwB,CAAtC;AAFO,eAAhB;;AAKA,kBAAI6Q,UAAUC,OAAOC,QAAP,CAAgBC,IAAhB,CAAqBC,UAArB,GACZ,kBADY,GAEZ,eAFF;;AAIA,kBAAIC,YAAYC,SAAS3N,MAAMpB,aAAf,IAAgC,GAAhD;AACA,kBAAI4N,WAAW/H,KAAKqI,GAAL,CAASD,YAAU,CAAnB,EAAsB,GAAtB,IAA6Ba,SAA5C;AACA,kBAAIE,aAAanJ,KAAKqI,GAAL,CAASD,YAAU,CAAnB,EAAsB,EAAtB,CAAjB;AACA,kBAAIgB,wBAAwBD,aAAW,CAAvC;;AAEA,kBAAI9D,UAAU;AACZrC,wBAAQ;AACNqG,0BAAQ;AACNxO,2BAAO;AACLwN,2BAAK9M,MAAMV,KAAN,CAAYC,QADZ;AAELmL,2BAAK1K,MAAMV,KAAN,CAAYE,QAFZ;AAGLuK,kCAAY,EAAEsC,OAAOgB,OAAT,EAHP;AAILU,8BAAQ,EAAE1B,OAAO,IAAT,EAJH;AAKL2B,8BAAQ,EAAE9O,MAAM,KAAR,EALH;AAML0F,6BAAOgJ;AANF,qBADD;AASNK,2BAAO,EAAE/O,MAAM,KAAR,EATD;AAUNgM,2BAAO,EAAEhM,MAAM,KAAR,EAVD;AAWNgP,4BAAQ,EAAEf,QAAQ,CAAV,EAAagB,gBAAgB,CAA7B,EAXF;AAYNC,0BAAM,EAAEL,QAAQ,EAAEnJ,OAAO,CAAT,EAAV,EAZA;AAaNyJ,+BAAW;AACTC,8BAAQ/R,UADC;AAET2O,6BAAO;AACLhM,8BAAMc,MAAMV,KAAN,CAAYI,eADb;AAELyN,gCAAQ,CAFH;AAGLoB,8BAAM,EAAE9D,MAAM,EAAR;AAHD,uBAFE;AAOTvL,4BAAMc,MAAMV,KAAN,CAAYG,gBAPT;AAQTmF,6BAAOiJ;AARE,qBAbL;AAuBNxR,2BAAO;AACLgQ,6BAAOrM,MAAMjB,UAAN,GAAmB5C,iBAAiBC,IAAjB,EAAuBA,KAAKiN,YAA5B,CAAnB,GAA+D,IADjE;AAELmF,iCAAW,qBAAW;AAAE,+BAAO7B,cAAP;AAAwB,uBAF3C;AAGL4B,4BAAM,EAAE9D,MAAM+B,QAAR,EAAkBiC,QAAQ,gDAA1B;AAHD,qBAvBD;AA4BNvP,0BAAM;AA5BA;AADF;AADI,eAAd;;AAmCAsM,mBAAKkD,MAAL,CAAY1B,UAAZ;;AAEA,kBAAI2B,aAAa;AACfvS,sBAAM,CAAC,CAAC,CAAD,EAAIA,KAAKiN,YAAT,CAAD;AADS,eAAjB;;AAIAvM,gBAAE8R,IAAF,CAAO5B,UAAP,EAAmB,CAAC2B,UAAD,CAAnB,EAAiC7E,OAAjC;AACD;;AAED,qBAAS+E,YAAT,GAAwB;AACtB,kBAAIjK,QAAQ4G,KAAK5G,KAAL,KAAe,EAA3B;AACA,kBAAIA,QAAQ,EAAZ,EAAgB;AACd;AACA;AACAkK,2BAAWD,YAAX,EAAyB,EAAzB;AACA;AACD;;AAED,kBAAI3C,SAASR,KAAKQ,MAAlB;AACA,kBAAIc,aAAalQ,EAAE,aAAF,CAAjB;AACA,kBAAImQ,UAAU,EAAd;AACAA,sBAAQG,QAAR,GAAmB,UAAnB;;AAEA,kBAAIpN,MAAMf,SAAN,CAAgBE,IAApB,EAA0B;AACxB8N,wBAAQ8B,MAAR,GAAiB,KAAjB;AACA9B,wBAAQ+B,IAAR,GAAe,MAAf;AACA/B,wBAAQrI,KAAR,GAAiBA,QAAQ,EAAT,GAAe,IAA/B;AACA,oBAAIqK,sBAAsB/C,UAAU,GAAV,GAAgB,CAAhB,GAAqBzH,KAAKyK,KAAL,CAAYhD,SAAO,GAAnB,IAA2B,EAA5B,GAAkC,CAAhF;AACAe,wBAAQf,MAAR,GAAkBA,SAAS+C,mBAAV,GAAiC,IAAlD;AACD,eAND,MAMO;AACLhC,wBAAQ8B,MAAR,GAAiB,KAAjB;AACA9B,wBAAQ+B,IAAR,GAAe,MAAf;AACA/B,wBAAQrI,KAAR,GAAiBA,QAAQ,EAAT,GAAe,IAA/B;AACAqI,wBAAQf,MAAR,GAAiBzH,KAAK2F,KAAL,CAAW8B,SAAS,IAApB,IAA4B,IAA7C;AACD;;AAEDc,yBAAWf,GAAX,CAAegB,OAAf;;AAEA,kBAAInD,UAAU;AACZqF,wBAAQ,EAAEjQ,MAAM,KAAR,EADI;AAEZuI,wBAAQ;AACN2H,yBAAQ;AACNlQ,0BAAM,IADA;AAENmQ,0BAAM,CAFA;AAGNC,+BAAW,CAHL;AAINjQ,+BAAWW,MAAMf,SAAN,CAAgBI;AAJrB;AADF,iBAFI;AAUZkQ,uBAAO,EAAErQ,MAAM,KAAR,EAVK;AAWZsQ,uBAAO;AACLtQ,wBAAM,KADD;AAELuQ,wBAAM,MAFD;AAGL3C,uBAAKpB,KAAKzI,KAAL,CAAW3E,IAAX,CAAgBoR,OAAhB,EAHA;AAILhF,uBAAKgB,KAAKzI,KAAL,CAAW1E,EAAX,CAAcmR,OAAd;AAJA,iBAXK;AAiBZC,sBAAM,EAAEC,WAAW,KAAb,EAAoB1Q,MAAM,KAA1B;AAjBM,eAAd;;AAoBAsM,mBAAKkD,MAAL,CAAY1B,UAAZ;;AAEA,kBAAI2B,aAAa;AACfvS,sBAAMA,KAAK2L,SADI;AAEfsE,uBAAOrM,MAAMf,SAAN,CAAgBG;AAFR,eAAjB;;AAKAtC,gBAAE8R,IAAF,CAAO5B,UAAP,EAAmB,CAAC2B,UAAD,CAAnB,EAAiC7E,OAAjC;AACD;;AAED,qBAAS3I,MAAT,GAAkB;AAChB,kBAAI,CAACuK,KAAKtP,IAAV,EAAgB;AAAE;AAAS;AAC3BA,qBAAOsP,KAAKtP,IAAZ;;AAEA;AACAA,mBAAKG,UAAL,GAAkByD,MAAMzD,UAAN,CAAiBsT,KAAjB,CAAuB,GAAvB,EAA4BvI,GAA5B,CAAgC,UAASwI,OAAT,EAAkB;AAClE,uBAAO7G,OAAO6G,QAAQC,IAAR,EAAP,CAAP;AACD,eAFiB,CAAlB;AAGA3T,mBAAKK,QAAL,GAAgBuD,MAAMhB,MAAtB;;AAEAgN;;AAEA,kBAAIU,OAAO1M,MAAMV,KAAN,CAAYJ,IAAZ,GAAmB,EAAnB,GAAwBuN,iBAAnC;;AAEA,kBAAIzM,MAAMlB,eAAN,IAAyB,CAACkR,MAAM5T,KAAKC,KAAX,CAA9B,EAAiD;AAC/C,oBAAIgQ,QAAQlQ,iBAAiBC,IAAjB,EAAuBA,KAAKC,KAA5B,CAAZ;AACA,oBAAIgQ,KAAJ,EAAW;AACTN,kCAAgBE,GAAhB,CAAoB,kBAApB,EAAwCI,KAAxC;AACA,sBAAIxL,MAAMoP,UAAV,EAAsB;AACpBzE,yBAAKS,GAAL,CAAS,kBAAT,EAA6BI,KAA7B;AACD,mBAFD,MAEO;AACLb,yBAAKS,GAAL,CAAS,kBAAT,EAA6B,EAA7B;AACD;AACF;AACF,eAVD,MAUO;AACLF,gCAAgBE,GAAhB,CAAoB,kBAApB,EAAwC,EAAxC;AACAT,qBAAKS,GAAL,CAAS,kBAAT,EAA6B,EAA7B;AACD;;AAEDT,mBAAK0E,IAAL,CAAUxD,IAAV;;AAEA,kBAAI1M,MAAMf,SAAN,CAAgBC,IAApB,EAA0B;AACxB2P;AACD;;AAED,kBAAI7O,MAAMV,KAAN,CAAYJ,IAAhB,EAAsB;AACpB0N;AACD;;AAEDpB,mBAAK2E,WAAL,CAAiB,SAAjB,EAA4BnQ,MAAM1C,KAAN,CAAYd,MAAZ,GAAqB,CAAjD;;AAEA,kBAAIwD,MAAM1C,KAAN,CAAYd,MAAZ,GAAqB,CAAzB,EAA4B;AAC1BsP,2BAAWF,QAAQwE,sBAAR,CAA+BpQ,MAAM1C,KAAN,CAAY,CAAZ,CAA/B,EAA+ClB,KAAK0G,UAApD,CAAX;AACD,eAFD,MAEO;AACLgJ,2BAAW,IAAX;AACD;AACF;;AAED,qBAASuE,0BAAT,GAAsC;AACpC;AACA,kBAAIC,mBAAmBxT,EAAE,yCAAF,CAAvB;;AAEA0O,mBAAK+E,UAAL,CAAgB,YAAW;AACzB,oBAAIvQ,MAAM1C,KAAN,CAAYd,MAAZ,KAAuB,CAA3B,EAA8B;AAAE;AAAQ;AACxCqP,yBAAS,YAAW;AAClByE,mCAAiBE,MAAjB;AACD,iBAFD;AAGD,eALD;;AAOAhF,mBAAKiF,KAAL,CAAW,UAASC,GAAT,EAAc;AACvB,oBAAI,CAAC5E,QAAL,EAAe;AAAE;AAAS;AAC1B;AACA,oBAAIhP,EAAE4T,GAAF,EAAOC,OAAP,CAAe,eAAf,EAAgCnU,MAAhC,GAAyC,CAA7C,EAAgD;AAAE;AAAS;;AAE3D,oBAAIsP,SAAShE,MAAT,KAAoB,QAAxB,EAAkC;AAChC,sBAAI8I,iBAAiBjM,OAAOkM,IAAP,CAAY/E,SAASgF,IAArB,EAA2B,QAA3B,CAArB;AACAF,iCAAeG,QAAf;AACA;AACD;;AAED,oBAAIjF,SAASgF,IAAT,CAAczF,OAAd,CAAsB,MAAtB,MAAkC,CAAtC,EAAyC;AACvC1G,yBAAOoM,QAAP,CAAgBD,IAAhB,GAAuBhF,SAASgF,IAAhC;AACD,iBAFD,MAEO;AACLjF,2BAAS,YAAW;AAClBF,8BAAUqF,GAAV,CAAclF,SAASgF,IAAvB;AACD,mBAFD;AAGD;;AAEDR,iCAAiBE,MAAjB;AACD,eApBD;;AAsBAhF,mBAAKyF,SAAL,CAAe,UAASC,CAAT,EAAY;AACzB,oBAAI,CAACpF,QAAL,EAAe;AAAE;AAAQ;;AAEzBwE,iCAAiBpS,IAAjB,CAAsB,qBAAqB4N,SAASvF,KAApD;AACA+J,iCAAiBa,QAAjB,CAA0BD,EAAEE,KAA5B,EAAmCF,EAAEG,KAAF,GAAQ,EAA3C;AACD,eALD;AAMD;;AAEDhB;;AAEA,iBAAKpQ,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAW;AAClCiB;AACAuK,mBAAK4F,kBAAL;AACD,aAHD;AAID;;;8CACmBjV,K,EAAO;AACzB,gBAAIK,EAAEuN,QAAF,CAAW,KAAKjK,KAAL,CAAW0J,QAAtB,CAAJ,EAAqC;AACnC,qBAAO,EAACA,UAAU,KAAK1J,KAAL,CAAW0J,QAAtB,EAAgCC,gBAAgB,IAAhD,EAAP;AACD;;AAED,gBAAIO,QAAQ7N,QAAQ,CAApB;AACA,gBAAI8N,MAAM,CAAC1F,KAAK2F,KAAL,CAAW3F,KAAKrC,GAAL,CAAS8H,KAAT,IAAkBzF,KAAK4F,IAAlC,CAAX;;AAEA,gBAAIC,OAAO7F,KAAK8F,GAAL,CAAS,EAAT,EAAa,CAACJ,GAAd,CAAX;AAAA,gBACAK,OAAON,QAAQI,IADf;AAAA,gBACqB;AACrBG,gBAFA;;AAIA,gBAAID,OAAO,GAAX,EAAgB;AACdC,qBAAO,CAAP;AACD,aAFD,MAEO,IAAID,OAAO,CAAX,EAAc;AACnBC,qBAAO,CAAP;AACA;AACA,kBAAID,OAAO,IAAX,EAAiB;AACfC,uBAAO,GAAP;AACA,kBAAEN,GAAF;AACD;AACF,aAPM,MAOA,IAAIK,OAAO,GAAX,EAAgB;AACrBC,qBAAO,CAAP;AACD,aAFM,MAEA;AACLA,qBAAO,EAAP;AACD;;AAEDA,oBAAQH,IAAR;;AAEA;AACA,gBAAI7F,KAAK2F,KAAL,CAAW/N,KAAX,MAAsBA,KAA1B,EAAiC;AAAE8N,oBAAM,CAAN;AAAU;;AAE7C,gBAAIvD,SAAS,EAAb;AACAA,mBAAO8C,QAAP,GAAkBjF,KAAKiG,GAAL,CAAS,CAAT,EAAYP,GAAZ,CAAlB;AACAvD,mBAAO+C,cAAP,GAAwB/C,OAAO8C,QAAP,GAAkBjF,KAAK2F,KAAL,CAAW3F,KAAKrC,GAAL,CAASqI,IAAT,IAAiBhG,KAAK4F,IAAjC,CAAlB,GAA2D,CAAnF;;AAEA,mBAAOzD,MAAP;AACD;;;;QAj5BkChK,S;;;;AA65BrCK,sBAAgBsU,WAAhB,GAA8B,aAA9B","file":"delta_ctrl.js","sourcesContent":["import {PanelCtrl} from 'app/plugins/sdk';\n\nimport moment from 'moment';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.gauge';\nimport kbn from 'app/core/utils/kbn';\nimport TimeSeries from 'app/core/time_series2';\n\nexport class DeltaPluginCtrl extends PanelCtrl {\n\n  constructor($scope, $injector, $rootScope) {\n    super($scope, $injector);\n    this.$rootScope = $rootScope;\n\n    var panelDefaults = {\n      links: [],\n      datasource: null,\n      maxDataPoints: 100,\n      interval: null,\n      targets: [{}],\n      cacheTimeout: null,\n      format: 'none',\n      prefix: '',\n      postfix: '',\n      nullText: null,\n      valueMaps: [\n        { value: 'null', op: '=', text: 'N/A' }\n      ],\n      mappingTypes: [\n        {name: 'value to text', value: 1},\n        {name: 'range to text', value: 2},\n      ],\n      rangeMaps: [\n        { from: 'null', to: 'null', text: 'N/A' }\n      ],\n      mappingType: 1,\n      nullPointMode: 'connected',\n      valueName: 'avg',\n      prefixFontSize: '50%',\n      valueFontSize: '80%',\n      postfixFontSize: '50%',\n      thresholds: '',\n      colorBackground: false,\n      colorValue: false,\n      colors: [\"rgba(245, 54, 54, 0.9)\", \"rgba(237, 129, 40, 0.89)\", \"rgba(50, 172, 45, 0.97)\"],\n      sparkline: {\n        show: false,\n        full: false,\n        lineColor: 'rgb(31, 120, 193)',\n        fillColor: 'rgba(31, 118, 189, 0.18)',\n      },\n      gauge: {\n        show: false,\n        minValue: 0,\n        maxValue: 100,\n        thresholdMarkers: true,\n        thresholdLabels: false\n      },\n      tableColumn: '',\n      dayInterval: 'NOW',\n      hourInterval: 'NOW',\n      minuteInterval: 'NOW',\n    };\n\n    _.defaults(this.panel, panelDefaults);\n\n    //this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    //this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('refresh', this.OnRefresh.bind(this));\n\n    this.$q = $injector.get('$q');\n    this.datasourceSrv = $injector.get('datasourceSrv');\n    this.timeSrv = $injector.get('timeSrv');\n    this.templateSrv = $injector.get('templateSrv');\n    this.scope = $scope;\n\n  }\n\n  onInitEditMode() {\n    this.fontSizes = ['20%', '30%','50%','70%','80%','100%', '110%', '120%', '150%', '170%', '200%'];\n    this.addEditorTab('Metrics', 'public/plugins/grafana-delta-panel/editor.html', 2);\n    this.addEditorTab('Options', 'public/app/plugins/panel/singlestat/editor.html', 3);\n    this.addEditorTab('Value Mappings', 'public/app/plugins/panel/singlestat/mappings.html', 4);\n    this.addEditorTab('Delta', 'public/plugins/grafana-delta-panel/delta_config.html', 5);\n    this.unitFormats = kbn.getUnitFormats();\n  }\n\n  setUnitFormat(subItem) {\n    this.panel.format = subItem.value;\n    this.render();\n  }\n\n  //GOT FROM https://raw.githubusercontent.com/grafana/grafana/master/public/app/features/panel/metrics_panel_ctrl.ts\n  OnRefresh() {\n    // ignore fetching data if another panel is in fullscreen\n    if (this.otherPanelInFullscreenMode()) { return; }\n\n    // if we have snapshot data use that\n    if (this.panel.snapshotData) {\n      this.updateTimeRange();\n      var data = this.panel.snapshotData;\n      // backward compatability\n      if (!_.isArray(data)) {\n        data = data.data;\n      }\n\n      this.events.emit('data-snapshot-load', data);\n      return;\n    }\n\n    // // ignore if we have data stream\n    if (this.dataStream) {\n      return;\n    }\n\n    // clear loading/error state\n    delete this.error;\n    this.loading = true;\n\n    // load datasource service\n    this.setTimeQueryStart();\n    this.datasourceSrv.get(this.panel.datasource)\n    .then(this.updateTimeRange.bind(this))\n    .then(this.issueQueries.bind(this))\n    .then(this.handleQueryResult.bind(this))\n    .catch(err => {\n      // if cancelled  keep loading set to true\n      if (err.cancelled) {\n        console.log('Panel request cancelled', err);\n        return;\n      }\n\n      this.loading = false;\n      this.error = err.message || \"Request Error\";\n      this.inspector = {error: err};\n\n      if (err.data) {\n        if (err.data.message) {\n          this.error = err.data.message;\n        }\n        if (err.data.error) {\n          this.error = err.data.error;\n        }\n      }\n\n      this.events.emit('data-error', err);\n      console.log('Panel data error:', err);\n    });\n  }\n\n  setTimeQueryStart() {\n    this.timing.queryStart = new Date().getTime();\n  }\n\n  setTimeQueryEnd() {\n    this.timing.queryEnd = new Date().getTime();\n  }\n\n  calculateInterval() {\n    var intervalOverride = this.panel.interval;\n\n    // if no panel interval check datasource\n    if (intervalOverride) {\n      intervalOverride = this.templateSrv.replace(intervalOverride, this.panel.scopedVars);\n    } else if (this.datasource && this.datasource.interval) {\n      intervalOverride = this.datasource.interval;\n    }\n\n    var res = kbn.calculateInterval(this.range, this.resolution, intervalOverride);\n    this.interval = res.interval;\n    this.intervalMs = res.intervalMs;\n  }\n\n  applyPanelTimeOverrides() {\n    this.timeInfo = '';\n\n    // check panel time overrrides\n    if (this.panel.timeFrom) {\n      var timeFromInterpolated = this.templateSrv.replace(this.panel.timeFrom, this.panel.scopedVars);\n      var timeFromInfo = rangeUtil.describeTextRange(timeFromInterpolated);\n      if (timeFromInfo.invalid) {\n        this.timeInfo = 'invalid time override';\n        return;\n      }\n\n      if (_.isString(this.rangeRaw.from)) {\n        var timeFromDate = dateMath.parse(timeFromInfo.from);\n        this.timeInfo = timeFromInfo.display;\n        this.rangeRaw.from = timeFromInfo.from;\n        this.rangeRaw.to = timeFromInfo.to;\n        this.range.from = timeFromDate;\n        this.range.to = dateMath.parse(timeFromInfo.to);\n      }\n    }\n\n    if (this.panel.timeShift) {\n      var timeShiftInterpolated = this.templateSrv.replace(this.panel.timeShift, this.panel.scopedVars);\n      var timeShiftInfo = rangeUtil.describeTextRange(timeShiftInterpolated);\n      if (timeShiftInfo.invalid) {\n        this.timeInfo = 'invalid timeshift';\n        return;\n      }\n\n      var timeShift = '-' + timeShiftInterpolated;\n      this.timeInfo += ' timeshift ' + timeShift;\n      this.range.from = dateMath.parseDateMath(timeShift, this.range.from, false);\n      this.range.to = dateMath.parseDateMath(timeShift, this.range.to, true);\n\n      this.rangeRaw = this.range;\n    }\n\n    if (this.panel.hideTimeOverride) {\n      this.timeInfo = '';\n    }\n  }\n\n  updateTimeRange(datasource) {\n    this.datasource = datasource || this.datasource;\n    this.range = this.timeSrv.timeRange();\n    this.rangeRaw = this.range.raw;\n\n    this.applyPanelTimeOverrides();\n\n    if (this.panel.maxDataPoints) {\n      this.resolution = this.panel.maxDataPoints;\n    } else {\n      this.resolution = Math.ceil($(window).width() * (this.panel.span / 12));\n    }\n\n    this.calculateInterval();\n\n    return this.datasource;\n  }\n\n  issueQueries(datasource) {\n    return new Promise((resolve, reject) => {\n      this.datasource = datasource;\n\n      if (!this.panel.targets || this.panel.targets.length === 0) {\n        return this.$q.when([]);\n      }\n\n      // make shallow copy of scoped vars,\n      // and add built in variables interval and interval_ms\n      var scopedVars = Object.assign({}, this.panel.scopedVars, {\n        \"__interval\":     {text: this.interval,   value: this.interval},\n        \"__interval_ms\":  {text: this.intervalMs, value: this.intervalMs},\n      });\n\n      var metricsQuery = {\n        panelId: this.panel.id,\n        range: this.range,\n        rangeRaw: this.rangeRaw,\n        interval: this.interval,\n        intervalMs: this.intervalMs,\n        targets: this.panel.targets,\n        format: this.panel.renderer === 'png' ? 'png' : 'json',\n        maxDataPoints: this.resolution,\n        scopedVars: scopedVars,\n        cacheTimeout: this.panel.cacheTimeout\n      };\n\n      const dayI = this.panel.dayInterval === 'NOW' ? moment().date() : this.panel.dayInterval;\n      const hourI = this.panel.hourInterval === 'NOW' ? moment().hour() : this.panel.hourInterval;\n      const minuteI = this.panel.minuteInterval === 'NOW' ? moment().minute() : this.panel.minuteInterval;\n\n      const thisMonth = moment(metricsQuery.range.to).date(dayI).hour(hourI).minute(minuteI);\n      const beginThisMonth = moment(thisMonth).startOf('month');\n      const lastMonth = moment(thisMonth).subtract(1, 'month');\n      const beginLastMonth = moment(lastMonth).startOf('month');\n\n      const metricCop = Object.assign({}, metricsQuery);\n      metricsQuery.rangeRaw.from = beginThisMonth;\n      metricsQuery.rangeRaw.to = thisMonth;\n      return datasource.query(metricsQuery)\n      .then((res1) => {\n        metricCop.rangeRaw.from = beginLastMonth;\n        metricCop.rangeRaw.to = lastMonth;\n        this.panel.title = `Delta ${beginLastMonth.format('DD-MM hh-mm-ss a')} / ${lastMonth.format('DD-MM hh-mm-ss a')} - ${beginThisMonth.format('DD-MM hh-mm-ss a')} / ${thisMonth.format('DD-MM hh-mm-ss a')}`;\n        return datasource.query(metricCop)\n        .then((res2) => resolve([res1, res2]))\n        .catch((err) => reject(err));\n      })\n      .catch((err) => reject(err));\n    });\n  }\n\n  handleQueryResult(results) {\n    this.setTimeQueryEnd();\n    this.loading = false;\n\n    console.log(results);\n    if (results[0].data.length <= 0 || results[1].data.length <= 0) {\n      let error = new Error();\n      error.message = 'Not enougth series error';\n      error.data = '0 query entered';\n      throw error;\n    }\n\n    if (typeof results[0].data[0] === 'undefined'){\n      result = {data: []};\n      console.log('No result.');\n      return;\n    }\n\n    results[0].data[0].datapoints[0][0] -= results[1].data[0].datapoints[0][0]\n    var result = results[0];\n\n    // check for if data source returns subject\n    if (result && result.subscribe) {\n      this.handleDataStream(result);\n      return;\n    }\n\n    if (this.dashboard.snapshot) {\n      this.panel.snapshotData = result.data;\n    }\n\n    if (!result || !result.data) {\n      console.log('Data source query result invalid, missing data field:', result);\n      result = {data: []};\n    }\n\n    return this.events.emit('data-received', result.data);\n  }\n\n  onDataError(err) {\n    this.onDataReceived([]);\n  }\n\n  onDataReceived(dataList) {\n    const data = {};\n    if (dataList.length > 0 && dataList[0].type === 'table'){\n      this.dataType = 'table';\n      const tableData = dataList.map(this.tableHandler.bind(this));\n      this.setTableValues(tableData, data);\n    } else {\n      this.dataType = 'timeseries';\n      this.series = dataList.map(this.seriesHandler.bind(this));\n      this.setValues(data);\n    }\n    this.data = data;\n    this.render();\n  }\n\n  seriesHandler(seriesData) {\n    var series = new TimeSeries({\n      datapoints: seriesData.datapoints,\n      alias: seriesData.target,\n    });\n\n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n    return series;\n  }\n\n  tableHandler(tableData) {\n    const datapoints = [];\n    const columnNames = {};\n\n    tableData.columns.forEach((column, columnIndex) => {\n      columnNames[columnIndex] = column.text;\n    });\n\n    this.tableColumnOptions = columnNames;\n    if (!_.find(tableData.columns, ['text', this.panel.tableColumn])) {\n      this.setTableColumnToSensibleDefault(tableData);\n    }\n\n    tableData.rows.forEach((row) => {\n      const datapoint = {};\n\n      row.forEach((value, columnIndex) => {\n        const key = columnNames[columnIndex];\n        datapoint[key] = value;\n      });\n\n      datapoints.push(datapoint);\n    });\n\n    return datapoints;\n  }\n\n  setTableColumnToSensibleDefault(tableData) {\n    if (this.tableColumnOptions.length === 1) {\n      this.panel.tableColumn = this.tableColumnOptions[0];\n    } else {\n      this.panel.tableColumn = _.find(tableData.columns, (col) => { return col.type !== 'time'; }).text;\n    }\n  }\n\n  setTableValues(tableData, data) {\n    if (!tableData || tableData.length === 0) {\n      return;\n    }\n\n    if (tableData[0].length === 0 || !tableData[0][0][this.panel.tableColumn]) {\n      return;\n    }\n\n    let highestValue = 0;\n    let lowestValue = Number.MAX_VALUE;\n    const datapoint = tableData[0][0];\n    data.value = datapoint[this.panel.tableColumn];\n\n    if (_.isString(data.value)) {\n      data.valueFormatted = _.escape(data.value);\n      data.value = 0;\n      data.valueRounded = 0;\n    } else {\n      const decimalInfo = this.getDecimalsForValue(data.value);\n      const formatFunc = kbn.valueFormats[this.panel.format];\n      data.valueFormatted = formatFunc(datapoint[this.panel.tableColumn], decimalInfo.decimals, decimalInfo.scaledDecimals);\n      data.valueRounded = kbn.roundValue(data.value, this.panel.decimals || 0);\n    }\n\n    this.setValueMapping(data);\n  }\n\n  setColoring(options) {\n    if (options.background) {\n      this.panel.colorValue = false;\n      this.panel.colors = ['rgba(71, 212, 59, 0.4)', 'rgba(245, 150, 40, 0.73)', 'rgba(225, 40, 40, 0.59)'];\n    } else {\n      this.panel.colorBackground = false;\n      this.panel.colors = ['rgba(50, 172, 45, 0.97)', 'rgba(237, 129, 40, 0.89)', 'rgba(245, 54, 54, 0.9)'];\n    }\n    this.render();\n  }\n\n  invertColorOrder() {\n    var tmp = this.panel.colors[0];\n    this.panel.colors[0] = this.panel.colors[2];\n    this.panel.colors[2] = tmp;\n    this.render();\n  }\n\n  getDecimalsForValue(value) {\n    if (_.isNumber(this.panel.decimals)) {\n      return {decimals: this.panel.decimals, scaledDecimals: null};\n    }\n\n    var delta = value / 2;\n    var dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n    var magn = Math.pow(10, -dec),\n    norm = delta / magn, // norm is between 1.0 and 10.0\n    size;\n\n    if (norm < 1.5) {\n      size = 1;\n    } else if (norm < 3) {\n      size = 2;\n      // special case for 2.5, requires an extra decimal\n      if (norm > 2.25) {\n        size = 2.5;\n        ++dec;\n      }\n    } else if (norm < 7.5) {\n      size = 5;\n    } else {\n      size = 10;\n    }\n\n    size *= magn;\n\n    // reduce starting decimals if not needed\n    if (Math.floor(value) === value) { dec = 0; }\n\n    var result = {};\n    result.decimals = Math.max(0, dec);\n    result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n\n    return result;\n  }\n\n  setValues(data) {\n    data.flotpairs = [];\n\n    if (this.series.length > 1) {\n      var error = new Error();\n      error.message = 'Multiple Series Error';\n      error.data = 'Metric query returns ' + this.series.length +\n      ' series. Single Stat Panel expects a single series.\\n\\nResponse:\\n'+JSON.stringify(this.series);\n      throw error;\n    }\n\n    if (this.series && this.series.length > 0) {\n      var lastPoint = _.last(this.series[0].datapoints);\n      var lastValue = _.isArray(lastPoint) ? lastPoint[0] : null;\n\n      if (this.panel.valueName === 'name') {\n        data.value = 0;\n        data.valueRounded = 0;\n        data.valueFormatted = this.series[0].alias;\n      } else if (_.isString(lastValue)) {\n        data.value = 0;\n        data.valueFormatted = _.escape(lastValue);\n        data.valueRounded = 0;\n      } else {\n        data.value = this.series[0].stats[this.panel.valueName];\n        data.flotpairs = this.series[0].flotpairs;\n\n        var decimalInfo = this.getDecimalsForValue(data.value);\n        var formatFunc = kbn.valueFormats[this.panel.format];\n        data.valueFormatted = formatFunc(data.value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n        data.valueRounded = kbn.roundValue(data.value, decimalInfo.decimals);\n      }\n\n      // Add $__name variable for using in prefix or postfix\n      data.scopedVars = _.extend({}, this.panel.scopedVars);\n      data.scopedVars[\"__name\"] = {value: this.series[0].label};\n    }\n    this.setValueMapping(data);\n  }\n\n  setValueMapping(data) {\n    // check value to text mappings if its enabled\n    if (this.panel.mappingType === 1) {\n      for (let i = 0; i < this.panel.valueMaps.length; i++) {\n        let map = this.panel.valueMaps[i];\n        // special null case\n        if (map.value === 'null') {\n          if (data.value === null || data.value === void 0) {\n            data.valueFormatted = map.text;\n            return;\n          }\n          continue;\n        }\n\n        // value/number to text mapping\n        var value = parseFloat(map.value);\n        if (value === data.valueRounded) {\n          data.valueFormatted = map.text;\n          return;\n        }\n      }\n    } else if (this.panel.mappingType === 2) {\n      for (let i = 0; i < this.panel.rangeMaps.length; i++) {\n        let map = this.panel.rangeMaps[i];\n        // special null case\n        if (map.from === 'null' && map.to === 'null') {\n          if (data.value === null || data.value === void 0) {\n            data.valueFormatted = map.text;\n            return;\n          }\n          continue;\n        }\n\n        // value/number to range mapping\n        var from = parseFloat(map.from);\n        var to = parseFloat(map.to);\n        if (to >= data.valueRounded && from <= data.valueRounded) {\n          data.valueFormatted = map.text;\n          return;\n        }\n      }\n    }\n\n    if (data.value === null || data.value === void 0) {\n      data.valueFormatted = \"no value\";\n    }\n  }\n\n  removeValueMap(map) {\n    var index = _.indexOf(this.panel.valueMaps, map);\n    this.panel.valueMaps.splice(index, 1);\n    this.render();\n  }\n\n  addValueMap() {\n    this.panel.valueMaps.push({value: '', op: '=', text: '' });\n  }\n\n  removeRangeMap(rangeMap) {\n    var index = _.indexOf(this.panel.rangeMaps, rangeMap);\n    this.panel.rangeMaps.splice(index, 1);\n    this.render();\n  }\n\n  addRangeMap() {\n    this.panel.rangeMaps.push({from: '', to: '', text: ''});\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    var $location = this.$location;\n    var linkSrv = this.linkSrv;\n    var $timeout = this.$timeout;\n    var panel = ctrl.panel;\n    var templateSrv = this.templateSrv;\n    var data, linkInfo;\n    var $panelContainer = elem.find('.panel-container');\n    elem = elem.find('.singlestat-panel');\n\n    function setElementHeight() {\n      elem.css('height', ctrl.height + 'px');\n    }\n\n    function applyColoringThresholds(value, valueString) {\n      if (!panel.colorValue) {\n        return valueString;\n      }\n\n      var color = getColorForValue(data, value);\n      if (color) {\n        return '<span style=\"color:' + color + '\">'+ valueString + '</span>';\n      }\n\n      return valueString;\n    }\n\n    function getSpan(className, fontSize, value)  {\n      value = templateSrv.replace(value, data.scopedVars);\n      return '<span class=\"' + className + '\" style=\"font-size:' + fontSize + '\">' +\n      value + '</span>';\n    }\n\n    function getBigValueHtml() {\n      var body = '<div class=\"singlestat-panel-value-container\">';\n\n      if (panel.prefix) { body += getSpan('singlestat-panel-prefix', panel.prefixFontSize, panel.prefix); }\n\n      var value = applyColoringThresholds(data.value, data.valueFormatted);\n      body += getSpan('singlestat-panel-value', panel.valueFontSize, value);\n\n      if (panel.postfix) { body += getSpan('singlestat-panel-postfix', panel.postfixFontSize, panel.postfix); }\n\n      body += '</div>';\n\n      return body;\n    }\n\n    function getValueText() {\n      var result = panel.prefix ? panel.prefix : '';\n      result += data.valueFormatted;\n      result += panel.postfix ? panel.postfix : '';\n\n      return result;\n    }\n\n    function addGauge() {\n      var width = elem.width();\n      var height = elem.height();\n      var dimension = Math.min(width, height);\n\n      ctrl.invalidGaugeRange = false;\n      if (panel.gauge.minValue > panel.gauge.maxValue) {\n        ctrl.invalidGaugeRange = true;\n        return;\n      }\n\n      var plotCanvas = $('<div></div>');\n      var plotCss = {\n        top: '10px',\n        margin: 'auto',\n        position: 'relative',\n        height: (height * 0.9) + 'px',\n        width:  dimension + 'px'\n      };\n\n      plotCanvas.css(plotCss);\n\n      var thresholds = [];\n      for (var i = 0; i < data.thresholds.length; i++) {\n        thresholds.push({\n          value: data.thresholds[i],\n          color: data.colorMap[i]\n        });\n      }\n      thresholds.push({\n        value: panel.gauge.maxValue,\n        color: data.colorMap[data.colorMap.length  - 1]\n      });\n\n      var bgColor = config.bootData.user.lightTheme\n      ? 'rgb(230,230,230)'\n      : 'rgb(38,38,38)';\n\n      var fontScale = parseInt(panel.valueFontSize) / 100;\n      var fontSize = Math.min(dimension/5, 100) * fontScale;\n      var gaugeWidth = Math.min(dimension/6, 60);\n      var thresholdMarkersWidth = gaugeWidth/5;\n\n      var options = {\n        series: {\n          gauges: {\n            gauge: {\n              min: panel.gauge.minValue,\n              max: panel.gauge.maxValue,\n              background: { color: bgColor },\n              border: { color: null },\n              shadow: { show: false },\n              width: gaugeWidth,\n            },\n            frame: { show: false },\n            label: { show: false },\n            layout: { margin: 0, thresholdWidth: 0 },\n            cell: { border: { width: 0 } },\n            threshold: {\n              values: thresholds,\n              label: {\n                show: panel.gauge.thresholdLabels,\n                margin: 8,\n                font: { size: 18 }\n              },\n              show: panel.gauge.thresholdMarkers,\n              width: thresholdMarkersWidth,\n            },\n            value: {\n              color: panel.colorValue ? getColorForValue(data, data.valueRounded) : null,\n              formatter: function() { return getValueText(); },\n              font: { size: fontSize, family: '\"Helvetica Neue\", Helvetica, Arial, sans-serif' }\n            },\n            show: true\n          }\n        }\n      };\n\n      elem.append(plotCanvas);\n\n      var plotSeries = {\n        data: [[0, data.valueRounded]]\n      };\n\n      $.plot(plotCanvas, [plotSeries], options);\n    }\n\n    function addSparkline() {\n      var width = elem.width() + 20;\n      if (width < 30) {\n        // element has not gotten it's width yet\n        // delay sparkline render\n        setTimeout(addSparkline, 30);\n        return;\n      }\n\n      var height = ctrl.height;\n      var plotCanvas = $('<div></div>');\n      var plotCss = {};\n      plotCss.position = 'absolute';\n\n      if (panel.sparkline.full) {\n        plotCss.bottom = '5px';\n        plotCss.left = '-5px';\n        plotCss.width = (width - 10) + 'px';\n        var dynamicHeightMargin = height <= 100 ? 5 : (Math.round((height/100)) * 15) + 5;\n        plotCss.height = (height - dynamicHeightMargin) + 'px';\n      } else {\n        plotCss.bottom = \"0px\";\n        plotCss.left = \"-5px\";\n        plotCss.width = (width - 10) + 'px';\n        plotCss.height = Math.floor(height * 0.25) + \"px\";\n      }\n\n      plotCanvas.css(plotCss);\n\n      var options = {\n        legend: { show: false },\n        series: {\n          lines:  {\n            show: true,\n            fill: 1,\n            lineWidth: 1,\n            fillColor: panel.sparkline.fillColor,\n          },\n        },\n        yaxes: { show: false },\n        xaxis: {\n          show: false,\n          mode: \"time\",\n          min: ctrl.range.from.valueOf(),\n          max: ctrl.range.to.valueOf(),\n        },\n        grid: { hoverable: false, show: false },\n      };\n\n      elem.append(plotCanvas);\n\n      var plotSeries = {\n        data: data.flotpairs,\n        color: panel.sparkline.lineColor\n      };\n\n      $.plot(plotCanvas, [plotSeries], options);\n    }\n\n    function render() {\n      if (!ctrl.data) { return; }\n      data = ctrl.data;\n\n      // get thresholds\n      data.thresholds = panel.thresholds.split(',').map(function(strVale) {\n        return Number(strVale.trim());\n      });\n      data.colorMap = panel.colors;\n\n      setElementHeight();\n\n      var body = panel.gauge.show ? '' : getBigValueHtml();\n\n      if (panel.colorBackground && !isNaN(data.value)) {\n        var color = getColorForValue(data, data.value);\n        if (color) {\n          $panelContainer.css('background-color', color);\n          if (scope.fullscreen) {\n            elem.css('background-color', color);\n          } else {\n            elem.css('background-color', '');\n          }\n        }\n      } else {\n        $panelContainer.css('background-color', '');\n        elem.css('background-color', '');\n      }\n\n      elem.html(body);\n\n      if (panel.sparkline.show) {\n        addSparkline();\n      }\n\n      if (panel.gauge.show) {\n        addGauge();\n      }\n\n      elem.toggleClass('pointer', panel.links.length > 0);\n\n      if (panel.links.length > 0) {\n        linkInfo = linkSrv.getPanelLinkAnchorInfo(panel.links[0], data.scopedVars);\n      } else {\n        linkInfo = null;\n      }\n    }\n\n    function hookupDrilldownLinkTooltip() {\n      // drilldown link tooltip\n      var drilldownTooltip = $('<div id=\"tooltip\" class=\"\">hello</div>\"');\n\n      elem.mouseleave(function() {\n        if (panel.links.length === 0) { return;}\n        $timeout(function() {\n          drilldownTooltip.detach();\n        });\n      });\n\n      elem.click(function(evt) {\n        if (!linkInfo) { return; }\n        // ignore title clicks in title\n        if ($(evt).parents('.panel-header').length > 0) { return; }\n\n        if (linkInfo.target === '_blank') {\n          var redirectWindow = window.open(linkInfo.href, '_blank');\n          redirectWindow.location;\n          return;\n        }\n\n        if (linkInfo.href.indexOf('http') === 0) {\n          window.location.href = linkInfo.href;\n        } else {\n          $timeout(function() {\n            $location.url(linkInfo.href);\n          });\n        }\n\n        drilldownTooltip.detach();\n      });\n\n      elem.mousemove(function(e) {\n        if (!linkInfo) { return;}\n\n        drilldownTooltip.text('click to go to: ' + linkInfo.title);\n        drilldownTooltip.place_tt(e.pageX, e.pageY-50);\n      });\n    }\n\n    hookupDrilldownLinkTooltip();\n\n    this.events.on('render', function() {\n      render();\n      ctrl.renderingCompleted();\n    });\n  }\n  getDecimalsForValue(value) {\n    if (_.isNumber(this.panel.decimals)) {\n      return {decimals: this.panel.decimals, scaledDecimals: null};\n    }\n\n    var delta = value / 2;\n    var dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n    var magn = Math.pow(10, -dec),\n    norm = delta / magn, // norm is between 1.0 and 10.0\n    size;\n\n    if (norm < 1.5) {\n      size = 1;\n    } else if (norm < 3) {\n      size = 2;\n      // special case for 2.5, requires an extra decimal\n      if (norm > 2.25) {\n        size = 2.5;\n        ++dec;\n      }\n    } else if (norm < 7.5) {\n      size = 5;\n    } else {\n      size = 10;\n    }\n\n    size *= magn;\n\n    // reduce starting decimals if not needed\n    if (Math.floor(value) === value) { dec = 0; }\n\n    var result = {};\n    result.decimals = Math.max(0, dec);\n    result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n\n    return result;\n  }\n}\n\nfunction getColorForValue(data, value) {\n  for (var i = data.thresholds.length; i > 0; i--) {\n    if (value >= data.thresholds[i-1]) {\n      return data.colorMap[i];\n    }\n  }\n  return _.first(data.colorMap);\n}\n\nDeltaPluginCtrl.templateUrl = 'module.html';\n"]}